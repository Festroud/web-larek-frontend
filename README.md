# Проектная работа 'Веб-ларек'
Это учебный проект, выполненный в рамках курса Яндекс Практикума. Он представляет собой интернет-магазин для оформления заказов товаров, полезных веб-разработчикам.
Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```
или
```
yarn
yarn start
```
## Сборка

```
npm run build
```
или

```
yarn build
```
В проекте применяется трехслойный архитектурный паттерн *MVP (Model-View-Presenter)*, обеспечивающий разделение ответственности между слоями:

1) *Model* — отвечает за бизнес-логику и работу с API: загрузка каталога, отправка заказов, хранение и обновление данных пользователя.
2) *View* — управляет отображением: рендер интерфейса и UI-состояния.
3) *Presenter* — связывает модель и представление: обрабатывает события от View, обновляет данные в Model и инициирует обновление View. 
Дополнительно используется *EventEmitter* — как вспомогательный инструмент для связи компонентов и централизованного управления событиями.
____________________________________________________________________________________________________________________________________________________________

## Описание базовых классов

### Класс `Api`
Это класс для работы с REST API. Он обеспечивает выполнение HTTP-запросов (GET, POST, PUT, DELETE) с общими настройками.

#### Конструктор класса
`constructor(baseUrl: string, options?: RequestInit)`
*Поля:*
`baseUrl: string` — сохраняет переданный базовый URL.
`options: RequestInit`— включает заголовки (Content-Type: application/json) и другие опции.

#### Методы
— `get(uri: string): Promise<object>` - Выполняет GET-запрос по указанному пути (baseUrl + uri).
— `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - Выполняет POST, PUT или DELETE запрос с телом data.

#### Обработка ответа
Успех → response.json().
Ошибка → выбрасывается с data.error или statusText.


### Класс `EventEmitter`
Реализует паттерн «Наблюдатель» и интерфейс IEvents. Позволяет подписываться на события, уведомлять и управлять подписками.

#### Основные возможности:
- Подписка на событие `(on)`
- Отписка от события `(off)`
- Генерация события `(emit)`
- Подписка на все события `(onAll)`
- Сброс всех подписок `(offAll)`
- Генерация события как коллбек `(trigger)`

#### Методы
— `on(eventName, callback)` — подписка на событие (поддержка string и RegExp).
— `off(eventName, callback)` — отписка от определенного обработчика.
— `emit(eventName, data?)` — вызов всех слушателей соответствующего события.
— `onAll(callback)` — подписка на все события (получает eventName и data).
— `offAll()` — удаление всех подписчиков.
— `trigger(eventName, context?)` — возвращение функции, которая при вызове вызывает emit с context и event.

#### Типы
`EventName — string | RegExp` - тип имени события.
`EmitterEvent — { eventName: string; data: unknown }` - формат события для глобальных слушателей.
`IEvents` — интерфейс с методами `on, emit, trigger`.
________________________________________________________________________________________________________________________________________________________________

### Описание классов слоя **Model**

 ### Класс `ProductModel`
 Реализует интерфейс `IProductModel`
*Ответственность:* хранит список товаров, переданных через Presenter. Отвечает за доступ к данным: т.е. получение всех товаров и поиск по id.
*Методы:*
— `setProducts(products: IProduct[]): void` — сохраняет список товаров
— `getProducts(): ICardProduct[]` — возвращает весь список товаров
— `getProductById(id: string)` — возвращает товар по ID

### Класс `OrderModel`
Реализует интерфейс `IOrderModel`
*Ответственность:* отвечает за отправку запросов на оформление заказа в API. Принимает данные, подготовленные презентером, и отправляет их на сервер.
*Методы:*
`submitOrder(order: IOrderRequest): Promise<void>` — Отправляет запрос на оформление заказа, передавая все необходимые данные (список товаров, способ оплаты, контакты, адрес).

### Класс `CartModel`
Реализует интерфейс `ICartModel`
*Ответственность:* Хранение состояния корзины и управление списком выбранных товаров.

*Методы:*
— `addItem(productId: string, count?: number)` — добавляет товар в корзину.
— `removeItem(productId: string)` — удаляет товар.
— `clear()` — очищает корзину.
— `getItems(): Record<string, number>` — возвращает список товаров и их количество.
— `getTotalCount(): number` — возвращает общее количество товаров.
— `getTotalPrice(products: ICardProduct[]): number` — принимает массив товаров и  вычисляет общую стоимость.

### Класс `FormModel`
Реализует интерфейс `IFormModel`
*Ответственность:* Хранение и валидация пользовательских данных, необходимых для оформления заказа: контактной информации, адреса доставки, способа оплаты.
*состояние:*
— `contactInfo: { phone: string; email: string }`- хранит контактные данные пользователя.
— `deliveryInfo: { address: string; payment: string }` - хранит информацию по доставке и оплате.

*Методы:*
— `setOrderData(contactInfo: { phone: string; email: string }): void` - Устанавливает контактные данные.
— `validateContacts(): boolean` - Проверяет корректность email и телефона.
— `setOrderAddress(address: string): void` - Устанавливает адрес доставки.
— `setPaymentMethod(method: string): void` - Устанавливает способ оплаты.
— `validateOrder(): boolean` - Проверяет валидность адреса и способа оплаты.
— `getFormData(): { contactInfo: { phone: string; email: string }; deliveryInfo: { address: string; payment: string } }` - Возвращает все введённые пользователем данные для оформления заказа.
___________________________________________________________________________________________________________________________________________

### Описание классов слоя **View** 
Слой представления отвечает за отрисовку интерфейса, отображение данных и обработку действий пользователя.

### Класс `Catalog` 
Реализует интерфейс `ICatalog`
Компонент для отображения списка (галереи) карточек товаров.
*Ответственность:* управление списком товаров, добавление/удаление карточек из DOM.

*Методы:*
— `addCard(card: HTMLElement[]): void` — добавляет карточки в каталог.
— `clear(): void` — очищает каталог от всех карточек.

### Класс `Basket`
Реализует интерфейс `IBasket`
*Наследует:* `EventEmitter`
*Ответственность:* отображение списка выбранных товаров, их количества и общей суммы.

*Методы:*
`renderItems(items: HTMLElement[]): void` — отрисовывает список товаров в корзине.
`updateTotal(total: number): void` — отображает общую сумму.
При клике на кнопку удаления товара эмитит `basket: remove` с id.
При клике на 'оформить' эмитит basket: checkout

### Класс `Card`
Реализует интерфейс отображения карточки товара `ICardProduct`.
*Наследует:* `EventEmitter`
*Ответственность:* отрисовка информации о товаре (название, изображение, цена, категория), генерация событий при взаимодействии.

*Методы:*
— `render(product: ICardProduct): HTMLElement`
 Создаёт DOM-элемент карточки и настраивает обработчики событий.
 При клике на карточку эмитит событие 'card:click' с id товара.

### Класс `CardPreView`
*Наследует:* `Card`
*Ответственность:* расширенная карточка товара для модального окна, отображает полную информацию о товаре: описание, цену, кнопку действия.

*Методы:*
— `setButtonState(enabled: boolean): void` — активирует или деактивирует кнопку действия.
— `render(product: ICardProduct): HTMLElement` — расширяет родительский рендеринг, добавляет описание, цену и кнопку действия.
 При клике на кнопку эмитит событие 'card:buy' с id товара.

*Поведение событий:*
`card:click` — клик по карточке (используется для открытия превью).
`card:buy` — нажатие кнопки покупки в превью.


### Класс `Contacts`
Реализует интерфейс `IContacts`
*Наследует:* `EventEmitter`
*Ответственность:* сбор и валидация данных email и телефона, отображение ошибок.

*Методы:*
`setField(name: string, value: string): void`
`getField(name: string): string`
`validate(): boolean`
`showErrors(errors: string[]): void`
При отправке формы эмитит `contacts:submit`

### Класс `Success`
*Наследует:* `EventEmitter`
Модальное окно успешного оформления заказа.
*Ответственность:* отображение итоговой суммы и кнопки перехода к каталогу товаров(происходит закрытие окна после нажатия на кнопку).

*Методы:*
— `render(total: number): HTMLElement`
При закрытии эмитит `success: close`

### Класс `Modal`
*Наследует:* `EventEmitter`
Базовый компонент для управления модальными окнами.
*Ответственность:* открытие и закрытие модального окна.

*Методы:*
`open(content: HTMLElement): void` — отображает модальное окно с переданным содержимым.
`close(): void` — закрывает модальное окно.
При закрытии эмитит `modal: close`
____________________________________________________________________________________________________________________________________________________

### Класс `AppPresenter`
*Назначение:* Центральный компонент, реализующий Presenter паттерна MVP. Обрабатывает события от View, обновляет Model, инициирует изменения в интерфейсе.

*Зависимости:*
**Model:** `ProductModel, CartModel, FormModel, OrderModel`
**View:** `Catalog, Basket, Card, CardPreView, Contacts, Success, Modal`
**База:** `EventEmitter, Api`

Основные обработчики:
`handleCardClick(id)` — открывает модалку с карточкой товара.
`handleAddToCart(id)` — добавляет товар в корзину и обновляет отображение.
`handleRemoveFromCart(id)` — удаляет товар, пересчитывает сумму.
`handleSubmitContacts()` — валидирует и сохраняет контактные данные.
`handleSubmitOrder()` — собирает заказ, отправляет, показывает результат.
`handleModalClose()` — закрывает модалку и очищает временные состояния.

### Пользовательский сценарий: 

1. *Просмотр каталога*
Пользователь просматривает список товаров в виде карточек с изображениями, названиями и ценами.
2. *Просмотр деталей товара*
При клике на карточку товара открывается модальное окно с названием и полным описанием товара, увеличенным изображением, ценой, кнопкой 'Добавить в корзину'.
3. *Добавление в корзину*
Нажатие кнопки 'Добавить в корзину':
  3.1. Товар добавляется в корзину.
  3.2. Счетчик товаров в шапке сайта обновляется.
  3.3. Модальное окно закрывается.
4. *Повторение выбора*
Пользователь может:
  4.1. Продолжить просмотр каталога
  4.2. Добавить другие товары по той же схеме
  4.3. Все выбранные товары сохраняются в корзине
5. *Просмотр корзины*
При клике на иконку корзины:
  5.1. Открывается модальное окно с перечнем выбранных товаров
  5.2. Для каждого товара отображается: название, цена за единицу, кнопка удаления, показывается общая сумма заказа, и кнопка оформления заказа
6.*Оформление заказа*
После нажатия 'Оформить заказ' в корзине:
Рендерится модальное окно с формой оформления заказа
*Форма содержит:*
— Переключатель оплаты (онлайн/наличные)
— Поле 'Адрес доставки'
— Поля 'Email' и "Телефон'
— кнопка оплаты

При вводе данных форма проверяет их корректность
Кнопка 'Оплатить' активируется только при валидных данных
Нажатие кнопки отправляет заказ
Подтверждение
*После успешной оплаты:*
Модальное окно меняет содержимое на:
Сообщение 'Заказ оформлен!'
Показывает итоговую списанную сумму
Кнопку 'За новыми покупками'
*Корзина автоматически очищается*

7. *Завершение*
При клике 'За новыми покупками' модальное окно закрывается
Пользователь продолжает покупки
